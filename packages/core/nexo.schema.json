{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Nexo App Manifest",
  "description": "Configuration file for Nexo platform user apps",
  "type": "object",
  "required": ["id", "name", "version", "basePath", "assets"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "id": {
      "type": "string",
      "pattern": "^[a-z0-9-]+$",
      "description": "Unique app identifier (lowercase letters, numbers, hyphens only)"
    },
    "name": {
      "type": "string",
      "description": "Display name of the app"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+",
      "description": "Semantic version number"
    },
    "description": {
      "type": "string",
      "description": "Brief description of the app"
    },
    "author": {
      "type": "string",
      "description": "App author name"
    },
    "icon": {
      "type": "string",
      "description": "Icon name from lucide-react (kebab-case)"
    },
    "homepage": {
      "type": "string",
      "format": "uri",
      "description": "App homepage URL"
    },
    "tags": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Tags for categorization"
    },
    "priority": {
      "type": "number",
      "description": "Loading priority (lower = higher priority)"
    },
    "basePath": {
      "type": "string",
      "pattern": "^/",
      "description": "Base path for all app routes (must start with /)"
    },
    "framework": {
      "type": "string",
      "enum": ["react", "vue", "vanilla"],
      "description": "Frontend framework used"
    },
    "sandbox": {
      "type": "boolean",
      "description": "Whether to run in sandbox/iframe"
    },
    "assets": {
      "type": "object",
      "required": ["js"],
      "properties": {
        "js": {
          "type": "array",
          "items": { "type": "string" },
          "description": "JavaScript files to load (relative to app directory)"
        },
        "css": {
          "type": "array",
          "items": { "type": "string" },
          "description": "CSS files to load (relative to app directory)"
        }
      },
      "description": "Compiled assets to load"
    },
    "library": {
      "type": "string",
      "description": "Global variable name that app exports to (e.g., 'TodoApp')"
    },
    "permissions": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "name"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Permission identifier"
          },
          "name": {
            "type": "string",
            "description": "Display name"
          },
          "description": {
            "type": "string",
            "description": "Permission description"
          }
        }
      },
      "description": "Permissions defined by this app"
    },
    "pages": {
      "type": "array",
      "items": { "$ref": "#/definitions/page" },
      "description": "Pages - unified structure for menus and routes"
    },
    "lifecycle": {
      "type": "object",
      "properties": {
        "bootstrap": {
          "type": "string",
          "description": "Function name for app initialization"
        },
        "mount": {
          "type": "string",
          "description": "Function name for mounting app to container"
        },
        "unmount": {
          "type": "string",
          "description": "Function name for unmounting app"
        }
      },
      "description": "Lifecycle hook function names exported by the app"
    }
  },
  "definitions": {
    "page": {
      "type": "object",
      "required": ["id", "label", "path"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique page identifier"
        },
        "label": {
          "type": "string",
          "description": "Display label in menu"
        },
        "path": {
          "type": "string",
          "description": "Route path"
        },
        "icon": {
          "type": "string",
          "description": "Icon name from lucide-react"
        },
        "component": {
          "type": "string",
          "description": "Component name exported from the app bundle"
        },
        "title": {
          "type": "string",
          "description": "Page title (for document title)"
        },
        "description": {
          "type": "string",
          "description": "Page description"
        },
        "order": {
          "type": "number",
          "description": "Sort order (lower = higher)"
        },
        "hidden": {
          "type": "boolean",
          "description": "Hide from menu but keep route accessible"
        },
        "badge": {
          "oneOf": [{ "type": "string" }, { "type": "number" }],
          "description": "Badge text or number"
        },
        "permissions": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Required permissions"
        },
        "external": {
          "type": "boolean",
          "description": "Whether this is an external link"
        },
        "target": {
          "type": "string",
          "enum": ["_blank", "_self"],
          "description": "Link target"
        },
        "children": {
          "type": "array",
          "items": { "$ref": "#/definitions/page" },
          "description": "Child pages"
        }
      }
    }
  }
}
